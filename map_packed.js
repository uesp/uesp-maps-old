/*!
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *       http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
;function inherits(b,a){function c(){}c.prototype=a.prototype;b.superClass_=a.prototype;b.prototype=new c();b.prototype.constructor=b}function MarkerLabel_(a,b,c){this.marker_=a;this.handCursorURL_=a.handCursorURL;this.labelDiv_=document.createElement("div");this.labelDiv_.style.cssText="position: absolute; overflow: hidden;";this.eventDiv_=document.createElement("div");this.eventDiv_.style.cssText=this.labelDiv_.style.cssText;this.eventDiv_.setAttribute("onselectstart","return false;");this.eventDiv_.setAttribute("ondragstart","return false;");this.crossDiv_=MarkerLabel_.getSharedCross(b)}inherits(MarkerLabel_,google.maps.OverlayView);MarkerLabel_.getSharedCross=function(a){var b;if(typeof MarkerLabel_.getSharedCross.crossDiv==="undefined"){b=document.createElement("img");b.style.cssText="position: absolute; z-index: 1000002; display: none;";b.style.marginLeft="-8px";b.style.marginTop="-9px";b.src=a;MarkerLabel_.getSharedCross.crossDiv=b}return MarkerLabel_.getSharedCross.crossDiv};MarkerLabel_.prototype.onAdd=function(){var k=this;var e=false;var n=false;var l;var h,c;var a;var m;var j;var b;var d=20;var i="url("+this.handCursorURL_+")";var g=function(o){if(o.preventDefault){o.preventDefault()}o.cancelBubble=true;if(o.stopPropagation){o.stopPropagation()}};var f=function(){k.marker_.setAnimation(null)};this.getPanes().overlayImage.appendChild(this.labelDiv_);this.getPanes().overlayMouseTarget.appendChild(this.eventDiv_);if(typeof MarkerLabel_.getSharedCross.processed==="undefined"){this.getPanes().overlayImage.appendChild(this.crossDiv_);MarkerLabel_.getSharedCross.processed=true}this.listeners_=[google.maps.event.addDomListener(this.eventDiv_,"mouseover",function(o){if(k.marker_.getDraggable()||k.marker_.getClickable()){this.style.cursor="pointer";google.maps.event.trigger(k.marker_,"mouseover",o)}}),google.maps.event.addDomListener(this.eventDiv_,"mouseout",function(o){if((k.marker_.getDraggable()||k.marker_.getClickable())&&!n){this.style.cursor=k.marker_.getCursor();google.maps.event.trigger(k.marker_,"mouseout",o)}}),google.maps.event.addDomListener(this.eventDiv_,"mousedown",function(o){n=false;if(k.marker_.getDraggable()){e=true;this.style.cursor=i}if(k.marker_.getDraggable()||k.marker_.getClickable()){google.maps.event.trigger(k.marker_,"mousedown",o);g(o)}}),google.maps.event.addDomListener(document,"mouseup",function(p){var o;if(e){e=false;k.eventDiv_.style.cursor="pointer";google.maps.event.trigger(k.marker_,"mouseup",p)}if(n){if(m){o=k.getProjection().fromLatLngToDivPixel(k.marker_.getPosition());o.y+=d;k.marker_.setPosition(k.getProjection().fromDivPixelToLatLng(o));try{k.marker_.setAnimation(google.maps.Animation.BOUNCE);setTimeout(f,1406)}catch(q){}}k.crossDiv_.style.display="none";k.marker_.setZIndex(l);a=true;n=false;p.latLng=k.marker_.getPosition();google.maps.event.trigger(k.marker_,"dragend",p)}}),google.maps.event.addListener(k.marker_.getMap(),"mousemove",function(p){var o;if(e){if(n){p.latLng=new google.maps.LatLng(p.latLng.lat()-h,p.latLng.lng()-c);o=k.getProjection().fromLatLngToDivPixel(p.latLng);if(m){k.crossDiv_.style.left=o.x+"px";k.crossDiv_.style.top=o.y+"px";k.crossDiv_.style.display="";o.y-=d}k.marker_.setPosition(k.getProjection().fromDivPixelToLatLng(o));if(m){k.eventDiv_.style.top=(o.y+d)+"px"}google.maps.event.trigger(k.marker_,"drag",p)}else{h=p.latLng.lat()-k.marker_.getPosition().lat();c=p.latLng.lng()-k.marker_.getPosition().lng();l=k.marker_.getZIndex();j=k.marker_.getPosition();b=k.marker_.getMap().getCenter();m=k.marker_.get("raiseOnDrag");n=true;k.marker_.setZIndex(1000000);p.latLng=k.marker_.getPosition();google.maps.event.trigger(k.marker_,"dragstart",p)}}}),google.maps.event.addDomListener(document,"keydown",function(o){if(n){if(o.keyCode===27){m=false;k.marker_.setPosition(j);k.marker_.getMap().setCenter(b);google.maps.event.trigger(document,"mouseup",o)}}}),google.maps.event.addDomListener(this.eventDiv_,"click",function(o){if(k.marker_.getDraggable()||k.marker_.getClickable()){if(a){a=false}else{google.maps.event.trigger(k.marker_,"click",o);g(o)}}}),google.maps.event.addDomListener(this.eventDiv_,"dblclick",function(o){if(k.marker_.getDraggable()||k.marker_.getClickable()){}}),google.maps.event.addListener(this.marker_,"dragstart",function(o){if(!n){m=this.get("raiseOnDrag")}}),google.maps.event.addListener(this.marker_,"drag",function(o){if(!n){if(m){k.setPosition(d);k.labelDiv_.style.zIndex=1000000+(this.get("labelInBackground")?-1:+1)}}}),google.maps.event.addListener(this.marker_,"dragend",function(o){if(!n){if(m){k.setPosition(0)}}}),google.maps.event.addListener(this.marker_,"position_changed",function(){k.setPosition()}),google.maps.event.addListener(this.marker_,"zindex_changed",function(){k.setZIndex()}),google.maps.event.addListener(this.marker_,"visible_changed",function(){k.setVisible()}),google.maps.event.addListener(this.marker_,"labelvisible_changed",function(){k.setVisible()}),google.maps.event.addListener(this.marker_,"title_changed",function(){k.setTitle()}),google.maps.event.addListener(this.marker_,"labelcontent_changed",function(){k.setContent()}),google.maps.event.addListener(this.marker_,"labelanchor_changed",function(){k.setAnchor()}),google.maps.event.addListener(this.marker_,"labelclass_changed",function(){k.setStyles()}),google.maps.event.addListener(this.marker_,"labelstyle_changed",function(){k.setStyles()})]};MarkerLabel_.prototype.onRemove=function(){var a;this.labelDiv_.parentNode.removeChild(this.labelDiv_);this.eventDiv_.parentNode.removeChild(this.eventDiv_);for(a=0;a<this.listeners_.length;a++){google.maps.event.removeListener(this.listeners_[a])}};MarkerLabel_.prototype.draw=function(){this.setContent();this.setTitle();this.setStyles()};MarkerLabel_.prototype.setContent=function(){var a=this.marker_.get("labelContent");if(typeof a.nodeType==="undefined"){this.labelDiv_.innerHTML=a;this.eventDiv_.innerHTML=this.labelDiv_.innerHTML}else{this.labelDiv_.innerHTML="";this.labelDiv_.appendChild(a);a=a.cloneNode(true);this.eventDiv_.appendChild(a)}};MarkerLabel_.prototype.setTitle=function(){this.eventDiv_.title=this.marker_.getTitle()||""};MarkerLabel_.prototype.setStyles=function(){var b,a;this.labelDiv_.className=this.marker_.get("labelClass");this.eventDiv_.className=this.labelDiv_.className;this.labelDiv_.style.cssText="";this.eventDiv_.style.cssText="";a=this.marker_.get("labelStyle");for(b in a){if(a.hasOwnProperty(b)){this.labelDiv_.style[b]=a[b];this.eventDiv_.style[b]=a[b]}}this.setMandatoryStyles()};MarkerLabel_.prototype.setMandatoryStyles=function(){this.labelDiv_.style.position="absolute";this.labelDiv_.style.overflow="hidden";if(typeof this.labelDiv_.style.opacity!=="undefined"&&this.labelDiv_.style.opacity!==""){this.labelDiv_.style.MsFilter='"progid:DXImageTransform.Microsoft.Alpha(opacity='+(this.labelDiv_.style.opacity*100)+')"';this.labelDiv_.style.filter="alpha(opacity="+(this.labelDiv_.style.opacity*100)+")"}this.eventDiv_.style.position=this.labelDiv_.style.position;this.eventDiv_.style.overflow=this.labelDiv_.style.overflow;this.eventDiv_.style.opacity=0.01;this.eventDiv_.style.MsFilter='"progid:DXImageTransform.Microsoft.Alpha(opacity=1)"';this.eventDiv_.style.filter="alpha(opacity=1)";this.setAnchor();this.setPosition();this.setVisible()};MarkerLabel_.prototype.setAnchor=function(){var a=this.marker_.get("labelAnchor");this.labelDiv_.style.marginLeft=-a.x+"px";this.labelDiv_.style.marginTop=-a.y+"px";this.eventDiv_.style.marginLeft=-a.x+"px";this.eventDiv_.style.marginTop=-a.y+"px"};MarkerLabel_.prototype.setPosition=function(b){var a=this.getProjection().fromLatLngToDivPixel(this.marker_.getPosition());if(typeof b==="undefined"){b=0}this.labelDiv_.style.left=Math.round(a.x)+"px";this.labelDiv_.style.top=Math.round(a.y-b)+"px";this.eventDiv_.style.left=this.labelDiv_.style.left;this.eventDiv_.style.top=this.labelDiv_.style.top;this.setZIndex()};MarkerLabel_.prototype.setZIndex=function(){var a=(this.marker_.get("labelInBackground")?-1:+1);if(typeof this.marker_.getZIndex()==="undefined"){this.labelDiv_.style.zIndex=parseInt(this.labelDiv_.style.top,10)+a;this.eventDiv_.style.zIndex=this.labelDiv_.style.zIndex}else{this.labelDiv_.style.zIndex=this.marker_.getZIndex()+a;this.eventDiv_.style.zIndex=this.labelDiv_.style.zIndex}};MarkerLabel_.prototype.setVisible=function(){if(this.marker_.get("labelVisible")){this.labelDiv_.style.display=this.marker_.getVisible()?"block":"none"}else{this.labelDiv_.style.display="none"}this.eventDiv_.style.display=this.labelDiv_.style.display};function MarkerWithLabel(a){a=a||{};a.labelContent=a.labelContent||"";a.labelAnchor=a.labelAnchor||new google.maps.Point(0,0);a.labelClass=a.labelClass||"markerLabels";a.labelStyle=a.labelStyle||{};a.labelInBackground=a.labelInBackground||false;if(typeof a.labelVisible==="undefined"){a.labelVisible=true}if(typeof a.raiseOnDrag==="undefined"){a.raiseOnDrag=true}if(typeof a.clickable==="undefined"){a.clickable=true}if(typeof a.draggable==="undefined"){a.draggable=false}if(typeof a.optimized==="undefined"){a.optimized=false}a.crossImage=a.crossImage||"http"+(document.location.protocol==="https:"?"s":"")+"://maps.gstatic.com/intl/en_us/mapfiles/drag_cross_67_16.png";a.handCursor=a.handCursor||"http"+(document.location.protocol==="https:"?"s":"")+"://maps.gstatic.com/intl/en_us/mapfiles/closedhand_8_8.cur";a.optimized=false;this.label=new MarkerLabel_(this,a.crossImage,a.handCursor);google.maps.Marker.apply(this,arguments)}inherits(MarkerWithLabel,google.maps.Marker);MarkerWithLabel.prototype.setMap=function(a){google.maps.Marker.prototype.setMap.apply(this,arguments);this.label.setMap(a)};
/*!
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *       http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
;function InfoBox(a){a=a||{};google.maps.OverlayView.apply(this,arguments);this.content_=a.content||"";this.disableAutoPan_=a.disableAutoPan||false;this.maxWidth_=a.maxWidth||0;this.pixelOffset_=a.pixelOffset||new google.maps.Size(0,0);this.position_=a.position||new google.maps.LatLng(0,0);this.zIndex_=a.zIndex||null;this.boxClass_=a.boxClass||"infoBox";this.boxStyle_=a.boxStyle||{};this.closeBoxMargin_=a.closeBoxMargin||"2px";this.closeBoxURL_=a.closeBoxURL||"http://www.google.com/intl/en_us/mapfiles/close.gif";if(a.closeBoxURL===""){this.closeBoxURL_=""}this.infoBoxClearance_=a.infoBoxClearance||new google.maps.Size(1,1);this.isHidden_=a.isHidden||false;this.alignBottom_=a.alignBottom||false;this.pane_=a.pane||"floatPane";this.enableEventPropagation_=a.enableEventPropagation||false;this.div_=null;this.closeListener_=null;this.eventListener1_=null;this.eventListener2_=null;this.eventListener3_=null;this.moveListener_=null;this.contextListener_=null;this.fixedWidthSet_=null}InfoBox.prototype=new google.maps.OverlayView();InfoBox.prototype.createInfoBoxDiv_=function(){var d;var a=this;var b=function(f){f.cancelBubble=true;if(f.stopPropagation){f.stopPropagation()}};var c=function(f){f.returnValue=false;if(f.preventDefault){f.preventDefault()}if(!a.enableEventPropagation_){b(f)}};if(!this.div_){this.div_=document.createElement("div");this.setBoxStyle_();if(typeof this.content_.nodeType==="undefined"){this.div_.innerHTML=this.getCloseBoxImg_()+this.content_}else{this.div_.innerHTML=this.getCloseBoxImg_();this.div_.appendChild(this.content_)}this.getPanes()[this.pane_].appendChild(this.div_);this.addClickHandler_();if(this.div_.style.width){this.fixedWidthSet_=true}else{if(this.maxWidth_!==0&&this.div_.offsetWidth>this.maxWidth_){this.div_.style.width=this.maxWidth_;this.div_.style.overflow="auto";this.fixedWidthSet_=true}else{d=this.getBoxWidths_();this.div_.style.width=(this.div_.offsetWidth-d.left-d.right)+"px";this.fixedWidthSet_=false}}this.panBox_(this.disableAutoPan_);if(!this.enableEventPropagation_){this.eventListener1_=google.maps.event.addDomListener(this.div_,"mousedown",b);this.eventListener2_=google.maps.event.addDomListener(this.div_,"click",b);this.eventListener3_=google.maps.event.addDomListener(this.div_,"dblclick",b);this.eventListener4_=google.maps.event.addDomListener(this.div_,"mouseover",function(f){this.style.cursor="default"})}this.contextListener_=google.maps.event.addDomListener(this.div_,"contextmenu",c);google.maps.event.trigger(this,"domready")}};InfoBox.prototype.getCloseBoxImg_=function(){var a="";if(this.closeBoxURL_!==""){a="<img";a+=" src='"+this.closeBoxURL_+"'";a+=" align=right";a+=" style='";a+=" position: relative;";a+=" cursor: pointer;";a+=" margin: "+this.closeBoxMargin_+";";a+="'>"}return a};InfoBox.prototype.addClickHandler_=function(){var a;if(this.closeBoxURL_!==""){a=this.div_.firstChild;this.closeListener_=google.maps.event.addDomListener(a,"click",this.getCloseClickHandler_())}else{this.closeListener_=null}};InfoBox.prototype.getCloseClickHandler_=function(){var a=this;return function(b){b.cancelBubble=true;if(b.stopPropagation){b.stopPropagation()}a.close();google.maps.event.trigger(a,"closeclick")}};InfoBox.prototype.panBox_=function(o){var d;var b;var m=0,i=0;if(!o){d=this.getMap();if(d instanceof google.maps.Map){if(!d.getBounds().contains(this.position_)){d.setCenter(this.position_)}b=d.getBounds();var q=d.getDiv();var j=q.offsetWidth;var l=q.offsetHeight;var f=this.pixelOffset_.width;var e=this.pixelOffset_.height;var k=this.div_.offsetWidth;var p=this.div_.offsetHeight;var h=this.infoBoxClearance_.width;var g=this.infoBoxClearance_.height;var a=this.getProjection().fromLatLngToContainerPixel(this.position_);if(a.x<(-f+h)){m=a.x+f-h}else{if((a.x+k+f+h)>j){m=a.x+k+f+h-j}}if(this.alignBottom_){if(a.y<(-e+g+p)){i=a.y+e-g-p}else{if((a.y+e+g)>l){i=a.y+e+g-l}}}else{if(a.y<(-e+g)){i=a.y+e-g}else{if((a.y+p+e+g)>l){i=a.y+p+e+g-l}}}if(!(m===0&&i===0)){var n=d.getCenter();d.panBy(m,i)}}}};InfoBox.prototype.setBoxStyle_=function(){var a,b;if(this.div_){this.div_.className=this.boxClass_;this.div_.style.cssText="";b=this.boxStyle_;for(a in b){if(b.hasOwnProperty(a)){this.div_.style[a]=b[a]}}if(typeof this.div_.style.opacity!=="undefined"&&this.div_.style.opacity!==""){this.div_.style.filter="alpha(opacity="+(this.div_.style.opacity*100)+")"}this.div_.style.position="absolute";this.div_.style.visibility="hidden";if(this.zIndex_!==null){this.div_.style.zIndex=this.zIndex_}}};InfoBox.prototype.getBoxWidths_=function(){var a;var c={top:0,bottom:0,left:0,right:0};var b=this.div_;if(document.defaultView&&document.defaultView.getComputedStyle){a=b.ownerDocument.defaultView.getComputedStyle(b,"");if(a){c.top=parseInt(a.borderTopWidth,10)||0;c.bottom=parseInt(a.borderBottomWidth,10)||0;c.left=parseInt(a.borderLeftWidth,10)||0;c.right=parseInt(a.borderRightWidth,10)||0}}else{if(document.documentElement.currentStyle){if(b.currentStyle){c.top=parseInt(b.currentStyle.borderTopWidth,10)||0;c.bottom=parseInt(b.currentStyle.borderBottomWidth,10)||0;c.left=parseInt(b.currentStyle.borderLeftWidth,10)||0;c.right=parseInt(b.currentStyle.borderRightWidth,10)||0}}}return c};InfoBox.prototype.onRemove=function(){if(this.div_){this.div_.parentNode.removeChild(this.div_);this.div_=null}};InfoBox.prototype.draw=function(){this.createInfoBoxDiv_();var a=this.getProjection().fromLatLngToDivPixel(this.position_);this.div_.style.left=(a.x+this.pixelOffset_.width)+"px";if(this.alignBottom_){this.div_.style.bottom=-(a.y+this.pixelOffset_.height)+"px"}else{this.div_.style.top=(a.y+this.pixelOffset_.height)+"px"}if(this.isHidden_){this.div_.style.visibility="hidden"}else{this.div_.style.visibility="visible"}};InfoBox.prototype.setOptions=function(a){if(typeof a.boxClass!=="undefined"){this.boxClass_=a.boxClass;this.setBoxStyle_()}if(typeof a.boxStyle!=="undefined"){this.boxStyle_=a.boxStyle;this.setBoxStyle_()}if(typeof a.content!=="undefined"){this.setContent(a.content)}if(typeof a.disableAutoPan!=="undefined"){this.disableAutoPan_=a.disableAutoPan}if(typeof a.maxWidth!=="undefined"){this.maxWidth_=a.maxWidth}if(typeof a.pixelOffset!=="undefined"){this.pixelOffset_=a.pixelOffset}if(typeof a.alignBottom!=="undefined"){this.alignBottom_=a.alignBottom}if(typeof a.position!=="undefined"){this.setPosition(a.position)}if(typeof a.zIndex!=="undefined"){this.setZIndex(a.zIndex)}if(typeof a.closeBoxMargin!=="undefined"){this.closeBoxMargin_=a.closeBoxMargin}if(typeof a.closeBoxURL!=="undefined"){this.closeBoxURL_=a.closeBoxURL}if(typeof a.infoBoxClearance!=="undefined"){this.infoBoxClearance_=a.infoBoxClearance}if(typeof a.isHidden!=="undefined"){this.isHidden_=a.isHidden}if(typeof a.enableEventPropagation!=="undefined"){this.enableEventPropagation_=a.enableEventPropagation}if(this.div_){this.draw()}};InfoBox.prototype.setContent=function(a){this.content_=a;if(this.div_){if(this.closeListener_){google.maps.event.removeListener(this.closeListener_);this.closeListener_=null}if(!this.fixedWidthSet_){this.div_.style.width=""}if(typeof a.nodeType==="undefined"){this.div_.innerHTML=this.getCloseBoxImg_()+a}else{this.div_.innerHTML=this.getCloseBoxImg_();this.div_.appendChild(a)}if(!this.fixedWidthSet_){this.div_.style.width=this.div_.offsetWidth+"px";if(typeof a.nodeType==="undefined"){this.div_.innerHTML=this.getCloseBoxImg_()+a}else{this.div_.innerHTML=this.getCloseBoxImg_();this.div_.appendChild(a)}}this.addClickHandler_()}google.maps.event.trigger(this,"content_changed")};InfoBox.prototype.setPosition=function(a){this.position_=a;if(this.div_){this.draw()}google.maps.event.trigger(this,"position_changed")};InfoBox.prototype.setZIndex=function(a){this.zIndex_=a;if(this.div_){this.div_.style.zIndex=a}google.maps.event.trigger(this,"zindex_changed")};InfoBox.prototype.getContent=function(){return this.content_};InfoBox.prototype.getPosition=function(){return this.position_};InfoBox.prototype.getZIndex=function(){return this.zIndex_};InfoBox.prototype.show=function(){this.isHidden_=false;if(this.div_){this.div_.style.visibility="visible"}};InfoBox.prototype.hide=function(){this.isHidden_=true;if(this.div_){this.div_.style.visibility="hidden"}};InfoBox.prototype.open=function(c,a){var b=this;if(a){this.position_=a.getPosition();this.moveListener_=google.maps.event.addListener(a,"position_changed",function(){b.setPosition(this.getPosition())})}this.setMap(c);if(this.div_){this.panBox_()}};InfoBox.prototype.close=function(){if(this.closeListener_){google.maps.event.removeListener(this.closeListener_);this.closeListener_=null}if(this.eventListener1_){google.maps.event.removeListener(this.eventListener1_);google.maps.event.removeListener(this.eventListener2_);google.maps.event.removeListener(this.eventListener3_);google.maps.event.removeListener(this.eventListener4_);this.eventListener1_=null;this.eventListener2_=null;this.eventListener3_=null;this.eventListener4_=null}if(this.moveListener_){google.maps.event.removeListener(this.moveListener_);this.moveListener_=null}if(this.contextListener_){google.maps.event.removeListener(this.contextListener_);this.contextListener_=null}this.setMap(null)};function CEuclideanProjection(){var a=256;this.pixelOrigin_=new google.maps.Point(a/2,a/2);this.pixelsPerLonDegree_=a/360;this.pixelsPerLonRadian_=a/(2*Math.PI);this.scaleLat=2;this.scaleLng=1;this.offsetLat=0;this.offsetLng=0}CEuclideanProjection.prototype.fromLatLngToPoint=function(d,c){var a=c||new google.maps.Point(0,0);var b=this.pixelOrigin_;a.x=(b.x+(d.lng()+this.offsetLng)*this.scaleLng*this.pixelsPerLonDegree_);a.y=(b.y+(-1*d.lat()+this.offsetLat)*this.scaleLat*this.pixelsPerLonDegree_);return a};CEuclideanProjection.prototype.fromPointToLatLng=function(a){var d=this;var b=d.pixelOrigin_;var c=(((a.x-b.x)/d.pixelsPerLonDegree_)/this.scaleLng)-this.offsetLng;var e=((-1*(a.y-b.y)/d.pixelsPerLonDegree_)/this.scaleLat)-this.offsetLat;return new google.maps.LatLng(e,c,true)};var umMap;var umCustomMapType;var umMapTileLayer;var umLocations=[];var umCellGridLines=[];var umCellGridLabels=[];var umCreatedCellGrid=false;var umLastGridLabelUpdate=false;var umWaitingForReponse=0;var umSkipUpdate=false;var umMapTypeOptions={getTileUrl:umGetMapTile,tileSize:new google.maps.Size(256,256),maxZoom:umMaxMapZoom,minZoom:umMinMapZoom,name:"Day"};var umCustomMapType=new google.maps.ImageMapType(umMapTypeOptions);umCustomMapType.projection=new CEuclideanProjection();var umNightMapTypeOptions={getTileUrl:umGetNightMapTile,tileSize:new google.maps.Size(256,256),maxZoom:umMaxMapZoom,minZoom:umMinMapZoom,name:"Night"};var umCustomNightMapType=new google.maps.ImageMapType(umNightMapTypeOptions);umCustomNightMapType.projection=new CEuclideanProjection();var umSimpleMapTypeOptions={getTileUrl:umGetSimpleMapTile,tileSize:new google.maps.Size(256,256),maxZoom:umMaxMapZoom,minZoom:umMinMapZoom,name:"Simple"};var umCustomSimpleMapType=new google.maps.ImageMapType(umSimpleMapTypeOptions);umCustomSimpleMapType.projection=new CEuclideanProjection();function umSetupMap(){var d=umEnableNightMap||umEnableSimpleMap;var c=["Day"];if(umEnableNightMap){c.push("Night")}if(umEnableSimpleMap){c.push("Simple")}var b={center:umMapDefaultCenter,zoom:umMapDefaultZoom,streetViewControl:false,disableDoubleClickZoom:true,overviewMapControl:true,overviewMapControlOptions:{position:google.maps.ControlPosition.BOTTOM_RIGHT,opened:false},mapTypeControl:d,mapTypeControlOptions:{mapTypeIds:c},panControl:true,panControlOptions:{position:google.maps.ControlPosition.TOP_RIGHT},zoomControl:true,zoomControlOptions:{style:google.maps.ZoomControlStyle.LARGE,position:google.maps.ControlPosition.TOP_RIGHT},scaleControl:false,scaleControlOptions:{position:google.maps.ControlPosition.TOP_LEFT}};umMap=new google.maps.Map(document.getElementById("map-canvas"),b);umMap.mapTypes.set(umWikiNameSpace,umCustomMapType);umMap.setMapTypeId(umWikiNameSpace);umMap.mapTypes.set("Day",umCustomMapType);if(umEnableSimpleMap){umMap.mapTypes.set("Simple",umCustomSimpleMapType)}if(umEnableNightMap){umMap.mapTypes.set("Night",umCustomNightMapType)}umMap.setMapTypeId("Day");var a=umGetInputValues();google.maps.event.addListenerOnce(umMap,"idle",function(){umUpdateMapFromInput(a);umUpdateShowHideCellGrid();umGetMarkers();umUpdateLink();umSetupEditMap();google.maps.event.addListener(umMap,"bounds_changed",function(){umUpdateDiffMarkers();umUpdateCellGridLabelsZoom()});google.maps.event.addListener(umMap,"center_changed",function(){umCheckMapBounds()});google.maps.event.addListener(umMap,"zoom_changed",function(){umUpdateCellGridLabelsZoom()});google.maps.event.addListener(umMap,"dblclick",umCenterMapOnClick)})}function umCenterMapOnClick(a){if(a.latLng!==undefined&&a.latLng!==null){umMap.panTo(a.latLng)}}function umCreateCellGrid(k){var e;var d;var g;var f;var q;var p;var m;var n;var l;var j;var i;k=typeof k!=="undefined"?k:umMapState.ShowCells;var o={strokeColor:"#ffff00",strokeOpacity:0.5,strokeWeight:1,clickable:false,draggable:false,editable:false,geodesic:false,map:umMap,visible:true,zIndex:100};var h={boxStyle:{border:"none",textAlign:"left",fontSize:"8pt",color:"#ffff00",opacity:0.5,zIndex:500},disableAutoPan:true,pixelOffset:new google.maps.Size(0,-2),closeBoxURL:"",isHidden:true,pane:"mapPane",enableEventPropagation:true};for(q=umMinCellX;q<=umMaxCellX;q++){e=q*umCellSize;g=umConvertXLocToLng(e);m=new google.maps.LatLng(umMapBounds.getSouthWest().lat(),g);n=new google.maps.LatLng(umMapBounds.getNorthEast().lat(),g);l=new google.maps.MVCArray([m,n]);j=o;j.path=l;i=new google.maps.Polyline(j);umCellGridLines.push(i)}for(p=umMinCellY;p<=umMaxCellY;p++){d=p*umCellSize;f=umConvertYLocToLat(d);m=new google.maps.LatLng(f,umMapBounds.getSouthWest().lng());n=new google.maps.LatLng(f,umMapBounds.getNorthEast().lng());l=new google.maps.MVCArray([m,n]);j=o;j.path=l;i=new google.maps.Polyline(j);umCellGridLines.push(i)}for(p=Math.ceil(umMinCellY/umCellGridLabelSpacing)*umCellGridLabelSpacing;p<=umMaxCellY;p+=umCellGridLabelSpacing){d=(p+1)*umCellSize;f=umConvertYLocToLat(d);for(q=Math.ceil(umMinCellX/umCellGridLabelSpacing)*umCellGridLabelSpacing;q<=umMaxCellX;q+=umCellGridLabelSpacing){e=q*umCellSize;g=umConvertXLocToLng(e);var c=new google.maps.LatLng(f,g);var b=h;b.position=c;b.content=q+","+(p);var a=new InfoBox(b);a.open(umMap);umCellGridLabels.push(a)}}umCreatedCellGrid=true}function umChangeClass(c,b,d){var a=new RegExp("(?:^|\\s)"+b+"(?!\\S)","g");c.className=c.className.replace(a,"");c.className+=" "+d}function umOnShowHideCellGrid(a){umMapState.ShowCells=!umMapState.ShowCells;umUpdateShowHideCellGrid(a);umUpdateLink()}function umUpdateShowHideCellGrid(a){a=typeof a!=="undefined"?a:document.getElementById("umShowCellGrid");umShowHideCellGrid(umMapState.ShowCells);if(a===null){return}if(umMapState.ShowCells){a.innerHTML="Hide Cell Grid";umChangeClass(a,"umCellGridHidden","umCellGridVisible")}else{a.innerHTML="Show Cell Grid";umChangeClass(a,"umCellGridVisible","umCellGridHidden")}}function umUpdateCellGridLabelsZoom(){var b=umMapState.ShowCells&&umMapState.Zoom>=umMinZoomCellLabels;if(umLastGridLabelUpdate==b){return}for(var a=0;a<umCellGridLabels.length;a++){if(b){umCellGridLabels[a].show()}else{umCellGridLabels[a].hide()}}umLastGridLabelUpdate=b}function umShowHideCellGrid(b){if(!umCreatedCellGrid){if(!b){return}umCreateCellGrid(b)}for(var a=0;a<umCellGridLines.length;a++){umCellGridLines[a].setVisible(b)}umUpdateCellGridLabelsZoom()}function umGetInputValues(){var a=[];var b=umSplitURLParams();a.lat=umGetURLParam("lat");a.lng=umGetURLParam("lng");a.zoom=umGetURLParam("zoom");a.locx=umGetURLParam("locx");if(!a.locx||a.locx===""){a.locx=umGetURLParam("oblocx")}a.locy=umGetURLParam("locy");if(!a.locy||a.locy===""){a.locy=umGetURLParam("oblocy")}a.cellx=umGetURLParam("cellx");a.celly=umGetURLParam("celly");a.search=umGetURLParam("search");a.startsearch=umGetURLParam("startsearch");a.centeron=umGetURLParam("centeron");a.showresults=umGetURLParam("showresults");a.showcells=umGetURLParam("showcells");a.showsearch=umGetURLParam("showsearch");a.showdisabled=umGetURLParam("showdisabled");a.showinfo=umGetURLParam("showinfo");a.disablecontrols=umGetURLParam("disablecontrols");a.edit=umGetURLParam("edit");a.cellresource=umGetURLParam("cellresource");return a}function umCheckMapBounds(){allowedBounds=umMapBounds;if(!allowedBounds.contains(umMap.getCenter())){var f=umMap.getCenter();var g=f.lng();var e=f.lat();var b=allowedBounds.getNorthEast().lng();var a=allowedBounds.getNorthEast().lat();var d=allowedBounds.getSouthWest().lng();var c=allowedBounds.getSouthWest().lat();if(g<d){g=d}if(g>b){g=b}if(e<c){e=c}if(e>a){e=a}umMap.setCenter(new google.maps.LatLng(e,g))}}function umConvertXLocToLng(b){var a=-180+((b/umCellSize+umCellOffsetX)/65536*360);return a}function umConvertYLocToLat(b){var a=90-((umCellOffsetY-b/umCellSize)/65536*180);return a}function umConvertLocToLatLng(d,b){var c=-180+((d/umCellSize+umCellOffsetX)/65536*360);var a=90-((umCellOffsetY-b/umCellSize)/65536*180);return new google.maps.LatLng(a,c)}function umConvertLngToLocX(a){if(a>0){a=-180}if(a<umMapBounds.getSouthWest().lng()){a=umMapBounds.getSouthWest().lng()}if(a>umMapBounds.getNorthEast().lng()){a=umMapBounds.getNorthEast().lng()}return(((a+180)*65536/360-umCellOffsetX)*umCellSize)}function umConvertLatToLocY(a){if(a<0){a=90}if(a<umMapBounds.getSouthWest().lat()){a=umMapBounds.getSouthWest().lat()}if(a>umMapBounds.getNorthEast().lat()){a=umMapBounds.getNorthEast().lat()}return(((90-a)*65536/180-umCellOffsetY)*-umCellSize)}function umGetMapTile(d,c){if(c>=umMinMapZoom&&c<=umMaxMapZoom){var b=Math.floor(umNumMapTilesX/Math.pow(2,umBaseMapZoom-c));var a=Math.floor(umNumMapTilesY/Math.pow(2,umBaseMapZoom-c));if(d.x<b&&d.y<a&&d.x>=0&&d.y>=0){return umImagePath+umGameDir+umTilePathPrefix+c+"/"+umMapImagePrefix+"-"+d.x+"-"+d.y+"-"+c+".jpg"}}return umImagePath+umOorMapTile}function umGetNightMapTile(d,c){if(c>=umMinMapZoom&&c<=umMaxMapZoom){var b=Math.floor(umNumMapTilesX/Math.pow(2,umBaseMapZoom-c));var a=Math.floor(umNumMapTilesY/Math.pow(2,umBaseMapZoom-c));if(d.x<b&&d.y<a&&d.x>=0&&d.y>=0){return umImagePath+umGameDir+"/night/zoom"+c+"/"+umMapImagePrefix+"-"+d.x+"-"+d.y+"-"+c+".jpg"}}return umImagePath+umOorNightMapTile}function umGetSimpleMapTile(d,c){if(c>=umMinMapZoom&&c<=umMaxMapZoom){var b=Math.floor(umNumMapTilesX/Math.pow(2,umBaseMapZoom-c));var a=Math.floor(umNumMapTilesY/Math.pow(2,umBaseMapZoom-c));if(d.x<b&&d.y<a&&d.x>=0&&d.y>=0){return umImagePath+umGameDir+"/simple/zoom"+c+"/"+umMapImagePrefix+"-"+d.x+"-"+d.y+"-"+c+".jpg"}}return umImagePath+umOorSimpleMapTile}function umUpdateLink(){umMapState.Update(umMap);var b=umCreateLink(umMap.getCenter());var a=document.getElementById("umMapLink");if(a){a.href=b}return b}function umCreateLinkZoom(b,a){var c=umMapURL+"?locx="+umConvertLngToLocX(b.lng()).toFixed(0)+"&locy="+umConvertLatToLocY(b.lat()).toFixed(0)+"&zoom="+a;if(umMapState.HasSearch()){c+="&search="+escape(umMapState.SearchText);if(umMapState.StartRow>0){c+="&startsearch="+escape(umMapState.StartRow)}}if(umMapState.ShowResults!=umDefaultShowResults){c+="&showresults="+umMapState.ShowResults}if(umMapState.ShowCells!=umDefaultShowCells){c+="&showcells="+umMapState.ShowCells}if(umMapState.ShowEdit!=umDefaultShowEdit){c+="&edit="+umMapState.ShowEdit}if(umMapState.ShowSearch!=umDefaultShowSearch){c+="&showsearch="+umMapState.ShowSearch}if(umMapState.DisableControls!=umDefaultDisableControls){c+="&disablecontrols="+umMapState.DisableControls}if(umMapState.ShowDisabled!=umDefaultShowDisabled){c+="&showdisabled="+umMapState.ShowDisabled}if(umMapState.ShowInfo!=umDefaultShowInfo){c+="&showinfo="+umMapState.ShowInfo}if(umMapState.CellResource!=umDefaultCellResource){c+="&cellresource="+umMapState.CellResource}return c}function umCreateLink(a){return umCreateLinkZoom(a,umMap.getZoom())}function umSplitURLParams(){var c=location.search.substring(1).toLowerCase();var e=c.split("&");var b=[];for(var a=0;a<e.length;a++){if(e[a].indexOf("=")>-1){var d=e[a].split("=");b[d[0]]=d[1]}else{b[e[a]]=""}}return b}function umGetURLParam(d){var c="";var b=location.search.substring(1);var e=b.split("&");for(var a=0;a<e.length;a++){if(e[a].indexOf(d+"=")===0){var f=e[a].split("=");c=f[1];break}}return c}function umUpdateMarkers(){if(umSkipUpdate){return}umUpdateLink();if(umMapState.HasSearch()){return}if(umWaitingForReponse){return}umMapState.ResetSearch();umDeleteLocations();umGetMarkers(umMapState)}function umUpdateDiffMarkers(){var n;var d;var l;var b;if(umSkipUpdate){return}if(umNoInitialGetMarkers){umNoInitialGetMarkers=false;umMapState.Update(umMap);umGetMarkers(umMapState);return}var e=umMapState.MapBounds;var h=umMapState.Zoom;var j=umConvertLngToLocX(e.getSouthWest().lng());var i=umConvertLatToLocY(e.getSouthWest().lat());var m=umConvertLngToLocX(e.getNorthEast().lng());var k=umConvertLatToLocY(e.getNorthEast().lat());umUpdateLink();if(umMapState.MapBounds===null){umMapState.Update(umMap)}var c=umConvertLngToLocX(umMapState.MapBounds.getSouthWest().lng());var a=umConvertLatToLocY(umMapState.MapBounds.getSouthWest().lat());var g=umConvertLngToLocX(umMapState.MapBounds.getNorthEast().lng());var f=umConvertLatToLocY(umMapState.MapBounds.getNorthEast().lat());if(umMapState.HasSearch()){return}umDeleteLocationsFromArea(umMapState.MapBounds,umMapState.Zoom);if(umMapState.Zoom>h){umAddMarkersBoundsZoom(umMapState,c,a,g,f,h)}if(c<j){n=c;d=j;l=a;b=f;umAddMarkersBounds(umMapState,n,l,d,b)}if(g>m){n=m;d=g;l=a;b=f;umAddMarkersBounds(umMapState,n,l,d,b)}if(f>k){n=c;d=g;l=k;b=f;umAddMarkersBounds(umMapState,n,l,d,b)}if(a<i){n=c;d=g;l=a;b=i;umAddMarkersBounds(umMapState,n,l,d,b)}}function umDeleteLocationsFromArea(b,a){var c;for(c=umLocations.length-1;c>=0;--c){if(umLocations[c].ID<0){continue}if(!b.contains(umLocations[c].MapPoint)||umLocations[c].DisplayLevel>a){umDeleteLocation(umLocations[c],c)}}}function umAddMarkersBounds(f,e,d,b,a){var c=new XMLHttpRequest();QueryStr=umMakeGetQueryBounds(f,e,d,b,a);c.open("GET",QueryStr,true);c.onreadystatechange=function(){if(c.readyState==4){umParseAddMapRequest(c)}};umWaitingForReponse=1;c.send(null)}function umAddMarkersBoundsZoom(f,e,d,b,a,g){var c=new XMLHttpRequest();QueryStr=umMakeGetQueryBounds(f,e,d,b,a);QueryStr+="&minzoom="+escape(g);c.open("GET",QueryStr,true);c.onreadystatechange=function(){if(c.readyState==4){umParseAddMapRequest(c)}};umWaitingForReponse=1;c.send(null)}function umParseAddMapRequest(f){var g=f.responseXML;var b=g.documentElement.getElementsByTagName("location");var e=0;if(b.length){e=umParseMapLocations(g,b)}var a=g.documentElement.getElementsByTagName("rowcount");var h=0;var d=0;var c=0;if(a.length>0){h=parseInt(a[0].getAttribute("totalrows"),10);d=parseInt(a[0].getAttribute("rowcount"),10);c=parseInt(a[0].getAttribute("startrow"),10)}umMapState.StartRow=c;umMapState.TotalResults+=h-(d-e);umMapState.NumResults+=e;umUpdateResultsText()}function umUpdateResultsText(){var b=document.getElementById("umSearchResultsHeader");var a;if(!b){return}if(umLocations.length>0){if(umMapState.HasSearch()){a="<div id='umResultTitle'>Results <b>"+(umMapState.StartRow+1)+"-"+(umMapState.StartRow+umLocations.length)+"</b> of <b>"+umMapState.TotalResults+"</b> matching locations for <B>"+umMapState.SearchText+"</B>.</div>"}else{a="<div id='umResultTitle'>Showing locations <b>"+(umMapState.StartRow+1)+"-"+(umMapState.StartRow+umLocations.length)+"</b> of <b>"+umMapState.TotalResults+"</b> in current map area.</div>"}}else{if(umMapState.HasSearch()){a="<div id='umResultTitle'>Found no matching locations for <b>"+umMapState.SearchText+"</b>.</div>"}else{a="<div id='umResultTitle'>Found no locations to display.</div>"}}b.innerHTML=a}function umUpdateMapFromInput(s){var q=s.lat;var j=s.lng;var i=s.zoom;var o=s.locx;var n=s.locy;var a=s.cellx;var y=s.celly;var f=s.centeron;var h=s.showresults;var t=s.showcells;var p=s.showsearch;var m=s.disablecontrols;var g=s.edit;var v=s.showdisabled;var l=s.showinfo;var w=s.cellresource;var e;var r;var k;umUpdateSearchFromInput(s);if(i===null||i===""){i=umMapLinkZoomedValue;e=umMapDefaultZoom}else{e=i=parseInt(i,10)}if(q&&q!==""){umMapState.ZoomTo(umMap,new google.maps.LatLng(parseFloat(q),parseFloat(j)),i)}else{if(o&&o!==""){umMapState.ZoomTo(umMap,umConvertLocToLatLng(parseFloat(o),parseFloat(n)),i)}else{if(a&&a!==""){var d=parseFloat(a)*umObCellSize;var c=parseFloat(y)*umObCellSize;umMapState.ZoomTo(umMap,umConvertLocToLatLng(d,c),i)}else{if(f&&f!==""){umMapState.ZoomTo(umMap,umMapDefaultCenter,umMapDefaultZoom);umGetCenterOnMarker(umMapState,unescape(f),i);umNoInitialGetMarkers=true}else{umMapState.ZoomTo(umMap,umMapDefaultCenter,e)}}}}if(h!==null&&h!==""){r=(h==="true");umUpdateSearchResultsButton(r)}else{umUpdateSearchResultsButton(umMapState.ShowResults)}if(t!==null&&t!==""){umMapState.ShowCells=(t==="true")}if(p!==null&&p!==""){umMapState.ShowSearch=(p==="true")}if(g!==null&&g!==""){umMapState.ShowEdit=(g==="true")}if(v!==null&&v!==""){umMapState.ShowDisabled=(v==="true")}if(l!==null&&l!==""){umMapState.ShowInfo=(l==="true")}if(w!==null&&w!==""){umMapState.CellResource=w;umCreateCellResources(w);umSetCellResourceList(w)}if(m!==null&&m!==""){umMapState.DisableControls=(m==="true")}if(umMapState.DisableControls){var u=document.getElementById("umMenuBar");var b=document.getElementById("umMapContainer");if(u){u.style.display="none"}if(b){b.style.top="0px"}}var x={clickable:umMapState.ShowInfo,overviewMapControl:!umMapState.DisableControls,panControl:!umMapState.DisableControls,zoomControl:!umMapState.DisableControls,draggable:!umMapState.DisableControls,keyboardShortcuts:!umMapState.DisableControls,scrollwheel:!umMapState.DisableControls};umMap.setOptions(x)}function umShowLocation(c,b){var a=umConvertLocToLatLng(c,b);umMapState.MoveTo(umMap,a)}function umShowLocationZoom(d,c,a){var b=umConvertLocToLatLng(d,c);umMapState.ZoomTo(umMap,b,a)}function umTestClick(){location.replace(umUpdateLink())}function umHelpEscKeyHandler(a){if(a.keyCode==27){onCloseHelp()}}function umOnShowHelp(c){var a=document.getElementById("umOverlayBottom");var b=document.getElementById("umOverlayContent");if(a===null){return}if(b===null){return}a.style.visibility="visible";b.style.visibility="visible";document.addEventListener("keyup",umHelpEscKeyHandler,false)}function onCloseHelp(c){var a=document.getElementById("umOverlayBottom");var b=document.getElementById("umOverlayContent");if(a===null){return}if(b===null){return}a.style.visibility="hidden";b.style.visibility="hidden";document.removeEventListener("keyup",umHelpEscKeyHandler)}function umGetCenterOnMarker(d,c,a){var b=new XMLHttpRequest();QueryStr=umMakeGetQueryCenterOn(d,c);b.open("GET",QueryStr,true);b.onreadystatechange=function(){if(b.readyState==4){umParseCenterOnMapRequest(b,a)}};umWaitingForReponse=1;b.send(null)}function umMakeGetQueryCenterOn(b,a){var c=umGetMapURL+"?game="+umGame+"&centeron="+escape(a);return c}function umParseCenterOnMapRequest(d,c){var e=d.responseXML;var a=e.documentElement.getElementsByTagName("location");if(a.length){var b=umCreateMapLocation(a[0]);umLocations[umLocations.length]=b;umCreateMapLabel(b);umAddSearchResult(b);umMapState.StartRow=0;umMapState.TotalResults=1;umMapState.NumResults=1;umUpdateResultsText();umMapState.ZoomTo(umMap,b.MapPoint,c);if(umMapState.HasSearch()){umGetMarkers(umMapState)}}else{umGetMarkers(umMapState)}umUpdateLink()}function umHtmlEncode(b){var a=document.createElement("div");a.innerText=a.textContent=b;b=a.innerHTML;return b}function umAddEvent(a,c,b){if(a.addEventListener){a.addEventListener(c,b,false)}else{if(a.attachEvent){a.attachEvent("on"+c,b)}}}function umClone(d){if(null==d||"object"!=typeof d){return d}if(d instanceof Date){var e=new Date();e.setTime(d.getTime());return e}if(d instanceof Array){var e=[];for(var c=0,b=d.length;c<b;c++){e[c]=clone(d[c])}return e}if(d instanceof Object){var e={};for(var a in d){if(d.hasOwnProperty(a)){e[a]=umClone(d[a])}}return e}throw new Error("Unable to copy obj! Its type isn't supported.")}google.maps.event.addDomListener(window,"load",umSetupMap);var umNextLocationID=111;function CMapLocation(b){if(b!==undefined&&b!==null){this.ID=parseInt(b.getAttribute("id"),10);this.X=Math.round(parseFloat(b.getAttribute("X")));this.Y=Math.round(parseFloat(b.getAttribute("Y")));this.Z=Math.round(parseFloat(b.getAttribute("Z")));this.Name=decodeURIComponent(b.getAttribute("name"));this.EditorID=decodeURIComponent(b.getAttribute("edid"));if(this.EditorID===null||this.EditorID==="null"||this.EditorID===undefined){this.EditorID=""}this.Worldspace=decodeURIComponent(b.getAttribute("ws"));this.Type=parseInt(b.getAttribute("type"),10);this.Namespace=decodeURIComponent(b.getAttribute("ns"));this.Region=decodeURIComponent(b.getAttribute("region"));this.DisplayLevel=parseInt(b.getAttribute("level"),10);this.LabelPosition=parseInt(b.getAttribute("labpos"),10);this.WikiPage=decodeURIComponent(b.getAttribute("page"));this.Tags=decodeURIComponent(b.getAttribute("tags"));if(this.NameSpace===""||this.Namespace===null||this.Namespace===undefined||this.Namespace==="null"){this.Namespace=umWikiNameSpace}if(this.Region===""||this.Region===null||this.Region===undefined||this.Region==="null"){this.Region=umRegionName}var a=parseInt(b.getAttribute("en"),10);this.Show=a!==0}else{this.ID=this.X=this.Y=this.Z=0;this.Name=this.EditorID=this.Region=this.WikiPage="";this.Tags="";this.Namespace=umWikiNameSpace;this.Region=this.Worldspace=umRegionName;this.Type=0;this.LabelPosition=8;this.DisplayLevel=16;this.Show=true}this.MapPoint=umConvertLocToLatLng(this.X,this.Y);this.Label=null;this.ResultElement=null}function umDeleteLocations(){var a;for(a=0;a<umLocations.length;++a){if(umLocations[a].Label){umRemoveMapLabel(umLocations[a].Label)}}umLocations=[]}function umUpdateMarkers(){umUpdateLink();if(umMapState.HasSearch()){return}if(umWaitingForReponse){return}umMapState.ResetSearch();umDeleteLocations();umGetMarkers()}function umMakeGetQueryBounds(e,d,c,b,a){var f=umGetMapURL+"?game="+umGame+"&zoom="+e.Zoom+"&BottomLeftX="+Math.round(d)+"&BottomLeftY="+Math.round(c)+"&TopRightX="+Math.round(b)+"&TopRightY="+Math.round(a);if(e.HasSearch()){f+="&SearchText="+encodeURIComponent(umMapState.SearchText)}if(e.StartRow){f+="&StartRow="+encodeURIComponent(umMapState.StartRow)}if(e.ShowDisabled){f+="&ShowDisabled=2"}return f}function umGetMarkers(){var a=new XMLHttpRequest();MapBounds=umMap.getBounds();if(MapBounds===null){MapBounds=umMapBounds}var d=umConvertLngToLocX(MapBounds.getSouthWest().lng());var b=umConvertLatToLocY(MapBounds.getSouthWest().lat());var e=umConvertLngToLocX(MapBounds.getNorthEast().lng());var c=umConvertLatToLocY(MapBounds.getNorthEast().lat());var f=umMakeGetQueryBounds(umMapState,d,b,e,c);a.open("GET",f,true);a.onreadystatechange=function(){if(a.readyState==4){umParseGetMapRequest(a)}};umWaitingForReponse=1;a.send(null)}function umParseGetMapLocations(j,i){var f=j.documentElement.getElementsByTagName("rowcount");var a=0;var g=0;var h=0;if(f.length>0){a=parseInt(f[0].getAttribute("totalrows"),10);g=parseInt(f[0].getAttribute("rowcount"),10);h=parseInt(f[0].getAttribute("startrow"),10)}umMapState.StartRow=h;umMapState.TotalResults=a;umMapState.NumResults=g;umParseMapLocations(j,i);var b="<center>";if(h>0){var d=h-50;if(d<0){d=0}b+="<a href='' onClick='umSearchFunction("+d+"); return(false);'><b>Prev</b></A> &nbsp; &nbsp; &nbsp;"}if(h+g+1<a){var d=h+g;if(d>a){d=a-1}if(d<0){d=0}b+="<a href='' onClick='umSearchFunction("+d+"); return(false);'><b>Next</b></a>"}b+="</center>";var e=document.getElementById("umSearchControlBottom");var c=document.getElementById("umSearchControlTop");if(c){c.innerHTML=b}if(e){e.innerHTML=b}}function umParseGetMapRequest(b){var c=b.responseXML;if(c===null||c.documentElement===null){umUpdateResultsText();umWaitingForReponse=0;return}var a=c.documentElement.getElementsByTagName("location");if(a!==null&&a.length){umParseGetMapLocations(c,a);umUpdateResultsText()}else{umUpdateResultsText()}umWaitingForReponse=0}function umCreateMapLocation(b){var a=new CMapLocation(b);return a}function umFindCurrentLocation(a){var b;for(b=0;b<umLocations.length;++b){if(umLocations[b].ID==a){return umLocations[b]}}return null}function umParseMapLocations(e,a){var b=0;for(var d=0;d<a.length;d++){var c=umCreateMapLocation(a[d]);if(umFindCurrentLocation(c.ID)===null){umLocations.push(c);umCreateMapLabel(c);umAddSearchResult(c);++b}}return b}function umCreateUniqueLocationID(){var a="locinfo"+umNextLocationID;umNextLocationID++;return a}function umOnExpandLocationInfo(c,a){var b=umFindLocationByInfoID(a);if(b===null){return}var d=umMakeExtLocationInfoContent(b,a);b.Label.infowindow.setContent(d)}function umOnShrinkLocationInfo(c,a){var b=umFindLocationByInfoID(a);if(b===null){return}var d=umMakeLocationInfoContent(b,a);b.Label.infowindow.setContent(d)}function umMakeInnerLocationInfoContent(b,a){var c="";c+="<div class='umLocationInfoName'>"+b.Name+"</div>";if(b.Type){c+="<div class='umLocationInfoType'>"+umGetMapMarkerType(b.Type)+"</div>"}c+="<div class='umLocationInfoPos'>Location: "+b.Region+" ("+b.X+", "+b.Y+", "+b.Z+")</div>";if(b.EditorID!==""){c+="<div class='umLocationInfoEdId'>EditorID: "+b.EditorID+"</div>"}if(b.WikiPage){c+="<div class='umLocationInfoLink'><a href=\"http://www.uesp.net/wiki/"+b.Namespace+":"+encodeURIComponent(b.WikiPage)+'">'+b.Namespace+":"+b.WikiPage+"</a></div>"}return c}function umMakeLocationInfoContent(b,a){var c;a=typeof a!=="undefined"?a:umCreateUniqueLocationID();if(a===null){a=umCreateUniqueLocationID()}c="<div class='umLocationInfo' id='"+a+"'>";c+=umMakeInnerLocationInfoContent(b,a);if(umMapState.ShowEdit){c+="<div class='umLocationExpandEdit' onClick='umOnOpenEditLocationInfo(this, &quot;"+a+"&quot;);'>Edit...</div>"}else{c+="<div class='umLocationExpand' onClick='umOnExpandLocationInfo(this, &quot;"+a+"&quot;);'>More...</div>"}c+="</div>";return c}function umMakeExtLocationInfoContent(b,a){var c;a=typeof a!=="undefined"?a:umCreateUniqueLocationID();if(a===null){a=umCreateUniqueLocationID()}c="<div class='umLocationInfoLarge' id='"+a+"'>";c+=umMakeInnerLocationInfoContent(b,a);c+="<div class='umLocationInfoPos'>&nbsp;</div>";c+="<div class='umLocationInfoPos'>Label Position: "+umGetLabelPositionLabel(b.LabelPosition)+" ("+b.LabelPosition+")</div>";c+="<div class='umLocationInfoPos'>Display Level: "+b.DisplayLevel+"</div>";c+="<div class='umLocationInfoPos'>Tags: "+b.Tags+"</div>";c+="<div class='umLocationInfoPos'>World Space: "+b.Worldspace+"</div>";c+="<div class='umLocationInfoPos'>Internal ID: "+b.ID+"</div>";c+="<div class='umLocationExpand' onClick='umOnShrinkLocationInfo(this, &quot;"+a+"&quot;);'>Less...</div>";c+="</div>";return c}function umUpdateMapLabel(a){if(!a){return null}if(a.Label){umRemoveMapLabel(a.Label);a.Label=null}return umCreateMapLabel(a)}function umFindLocationByInfoID(a){for(var b=0;b<umLocations.length;b++){if(umLocations[b].Label===null){continue}if(umLocations[b].Label.locationinfoid===a){return umLocations[b]}}return null}function umDeleteLocation(a,c){if(a===null||a===undefined){return}if(a.Label){a.Label.marker.setMap(null)}if(a.LabelListener){google.maps.event.removeListener(a.LabelListener)}if(a.ResultElement){var b=document.getElementById("umSearchResults");if(b!==null){b.removeChild(a.ResultElement)}}if(c===null||c===undefined){c=umLocations.indexOf(a)}umLocations.splice(c,1);--umMapState.NumResults;--umMapState.TotalResults}var CLabelClass=function(){this.id="";this.content="";this.marker=null;this.listeners=[];this.anchorLatLng=new google.maps.LatLng(0,0);this.markerOffset=new google.maps.Size(0,0);this.anchorPoint="topLeft";this.percentOpacity=100;this.infowindow=null;this.locationinfoid=null};function umCreateMapLabel(c){var d=new CLabelClass();var e="left";var g=c.Name.length*6+2;d.id="Label"+umLocations.length+umLocationIDCounter;d.anchorLatLng=c.MapPoint;d.anchorPoint="topLeft";d.markerOffset=new google.maps.Size(8,8);d.percentOpacity=100;switch(c.LabelPosition){case 1:d.anchorPoint="topLeft";e="left";d.markerOffset=new google.maps.Point(8,4);break;case 2:d.anchorPoint="topCenter";e="center";d.markerOffset=new google.maps.Point(g/2,4);break;case 3:d.anchorPoint="topRight";e="right";d.markerOffset=new google.maps.Point(g*0.9+5,4);break;case 4:d.anchorPoint="midRight";e="right";d.markerOffset=new google.maps.Point(g*0.9+5,16);break;case 5:d.anchorPoint="bottomRight";e="right";d.markerOffset=new google.maps.Point(g*0.9+5,26);break;case 6:d.anchorPoint="bottomCenter";e="center";d.markerOffset=new google.maps.Point(g/2,26);break;case 7:d.anchorPoint="bottomLeft";e="left";d.markerOffset=new google.maps.Point(8,26);break;case 9:d.anchorPoint="center";e="center";d.markerOffset=new google.maps.Point(g/2,16);break;case 8:default:d.anchorPoint="midLeft";e="left";d.markerOffset=new google.maps.Point(-8,16);break}var f={position:c.MapPoint,draggable:false,clickable:umMapState.ShowInfo,map:umMap,optimized:false,flat:true,icon:umGetMapMarkerIcon(c.Type),labelClass:(c.Show?"labels":"labelsdisabled"),labelStyle:{opacity:1,textAlign:e,width:g},labelContent:c.Name,labelAnchor:d.markerOffset};var a=new MarkerWithLabel(f);var b=new google.maps.InfoWindow({disableAutoPan:umMapState.DisableControls});d.locationinfoid=umCreateUniqueLocationID();d.content=umMakeLocationInfoContent(c,d.locationinfoid);b.setContent(d.content);b.locationinfoid=d.locationinfoid;d.infowindow=b;d.marker=a;d.listeners.push(google.maps.event.addListener(a,"click",function(h){b.open(umMap,a)}));d.listeners.push(google.maps.event.addListener(a,"dblclick",umCenterMapOnClick));++umLocationIDCounter;c.Label=d;return d}function umRemoveMapLabel(b){for(var a=0;a<b.listeners.length;a++){google.maps.event.removeListener(b.listeners[a])}b.listeners=[];b.marker.setMap(null)}function umGetLabelPositionLabel(a){switch(a){case 1:return"Bottom Right";case 2:return"Bottom Center";case 3:return"Bottom Left";case 4:return"Middle Left";case 5:return"Top Left";case 6:return"Top Center";case 7:return"Top Right";case 8:return"Middle Right";case 9:return"Center"}}var umDefaultShowDisabled=false;var umDefaultShowResults=false;var umDefaultShowCells=false;var umDefaultShowSearch=true;var umDefaultDisableControls=false;var umDefaultShowEdit=false;var umDefaultShowInfo=true;var umDefaultCellResource="";function CMapState(g,f,e,b,a,d,c){this.Center=g;this.Zoom=f;this.SearchText=e;this.NumResults=b;this.TotalResults=a;this.StartRow=d;this.MapBounds=c;this.ShowDisabled=umDefaultShowDisabled;this.ShowResults=umDefaultShowResults;this.ShowCells=umDefaultShowCells;this.ShowSearch=umDefaultShowSearch;this.DisableControls=umDefaultDisableControls;this.ShowEdit=umDefaultShowEdit;this.ShowInfo=umDefaultShowInfo;this.CellResource=umDefaultCellResource}CMapState.prototype.HasSearch=function(){return(this.SearchText!==null&&this.SearchText!=="")};CMapState.prototype.Update=function(a){this.Center=a.getCenter();this.Zoom=a.getZoom();this.MapBounds=a.getBounds()};CMapState.prototype.ZoomTo=function(b,c,a){umSkipUpdate=true;b.panTo(c);b.setZoom(a);umSkipUpdate=false;umUpdateDiffMarkers()};CMapState.prototype.MoveTo=function(a,b){a.panTo(b);this.Center=b;this.MapBounds=a.getBounds()};CMapState.prototype.ResetSearch=function(){this.NumResults=0;this.StartRow=0;this.SearchText="";this.TotalResults=0;umClearSearchResults()};var umMapState=new CMapState(umMapDefaultCenter,umMapDefaultZoom,"",0,0,0,umMapBounds);function umResetSearch(){var a=document.getElementById("umSearchInputText");if(a){a.value=""}umMapState.ResetSearch();umDeleteLocations();umGetMarkers(umMapState);umUpdateLink()}function umClearSearchResults(){var d=document.getElementById("umSearchResults");if(!d){return}var b=document.getElementById("umSearchControlBottom");var a=document.getElementById("umSearchControlTop");if(a){a.innerHTML=""}if(b){b.innerHTML=""}for(var c=d.childNodes.length-1;c>=0;--c){d.removeChild(d.childNodes[c])}}function umOnSearch(){umSearchFunction(0,umMapState.ShowDisabled);return false}function umSearchFunction(a,d){umMapState.ResetSearch();umDeleteLocations();var b=document.getElementById("umSearchInputText");if(b){var c=b.value;umMapState.SearchText=c.replace(/^\s*(\S*(\s+\S+)*)\s*$/,"$1");b.value=umMapState.SearchText;if(a){umMapState.StartRow=parseInt(a,10)}else{umMapState.StartRow=0}umGetMarkers(umMapState)}umUpdateLink()}function umOnShowHideSearchResults(){var b=document.getElementById("umSearchResultsArea");var a=document.getElementById("umSearchResultsButton");if(b===null){return}if(a===null){return}if(b.style.visibility=="hidden"){umUpdateSearchResultsButton(true)}else{umUpdateSearchResultsButton(false)}umUpdateLink()}function umUpdateSearchResultsButton(a){var d=document.getElementById("umSearchResultsArea");var c=document.getElementById("umSearchResultsButton");var b=document.getElementById("umSearchContainer");umMapState.ShowResults=a;if(d===null){return}if(c===null){return}if(b===null){return}if(a){d.style.visibility="visible";d.style.display="block";c.style.position="absolute";c.style.bottom="40px";c.innerHTML="<img src='"+umImagePath+umUpArrowIcon+"' </img> Hide Search Results <img src='"+umImagePath+umUpArrowIcon+"' </img>";b.style.height="100%"}else{d.style.visibility="hidden";d.style.display="none";c.style.position="relative";c.style.bottom="0px";c.innerHTML="<img src='"+umImagePath+umDownArrowIcon+"' </img> Show Search Results <img src='"+umImagePath+umDownArrowIcon+"' </img>";b.style.height="40px"}}function umAddSearchResultText(d,c){var g=document.getElementById("umSearchResults");if(!g){return}var b=document.createElement("div");b.setAttribute("divname",c);b.innerHTML=d;var a=0;for(var f=0;f<g.childNodes.length;f++){var e=g.childNodes[f].getAttribute("divname");if(e>c){g.insertBefore(b,g.childNodes[f]);a=1;break}}if(!a){g.appendChild(b)}return b}function umUpdateSearchFromInput(a){var c=a.search;var d;umMapState.SearchText=c;if(c&&c!==""){umMapState.SearchText=decodeURIComponent(c).replace(/\+/g," ");umMapState.StartRow=parseInt(a.startsearch,10);var b=document.getElementById("umSearchInputText");if(b){b.value=umMapState.SearchText}}if(umMapState.ShowSearch&&!umMapState.DisableControls){d=document.getElementById("umSearchContainer");d.style.display="block"}else{d=document.getElementById("umSearchContainer");d.style.display="none"}}function umCreateSearchResultText(b){var e=umGetMapMarkerType(b.Type);var a=umCreateLink(b.MapPoint);var c="<div id='umResult'><div id='umResultLinkBox'><nobr><div id='umResultIconBox'><img id='umResultIcon' src='"+umGetMapMarkerIcon(b.Type)+"' alt='["+e+"]' border='0' /></div> ";c+="<a id='umResultLink' href='"+a+"' onClick='umShowLocation("+b.X+","+b.Y+"); return(false);'>"+b.Name+"</A>";var d=umCreateLinkZoom(b.MapPoint,umMapLinkZoomedValue);c+=" <a href='"+d+"' id='umResultZoom' onClick='umShowLocationZoom("+b.X+","+b.Y+", "+umMapLinkZoomedValue+"); return(false);'>";c+="<img width='16' height='16' id='umZoomIcon' src='"+umImagePath+umZoomIcon+"' alt='[zoomto]' border='0'></a>";if(b.WikiPage){c+="<a id='umResultWikiLink' href=\"http://www.uesp.net/wiki/"+b.Namespace+":"+encodeURIComponent(b.WikiPage)+'" >';c+="<img width='32' height='16' src='"+umImagePath+umWikiPageIcon+"' border='0' alt='[Wiki Page]'/>";c+="</a>"}c+="</nobr>";c+="</div>";if(b.Type){c+=" <div id='umResultLocType'>"+e+", </div>"}else{c+=" <div id='umResultLocType'> </div>"}c+="<div id='umResultLoc'>"+b.Region+" ("+b.X+", "+b.Y+")";c+="</div></div>";return c}function umAddSearchResult(a){var b=umCreateSearchResultText(a);a.ResultElement=umAddSearchResultText(b,a.Name)}function umUpdateSearchResult(a){if(a===null||a.ResultElement===null){return}var b=umCreateSearchResultText(a);a.ResultElement.innerHTML=b}var umCellResourceObjects=[];var umCurrentCellResource="";var umCurrentResourceData=null;var umCellResourceCellX1=-57;var umCellResourceCellX2=61;var umCellResourceCellY1=-43;var umCellResourceCellY2=50;var umDefaultCellBoxOptions_Base={clickable:false,draggable:false,editable:false,fillOpacity:0.4,strokeColor:"#000000",strokeOpacity:0.5,strokeWeight:1,visible:true,zIndex:960};var umDefaultCellBoxOptions_Green=umClone(umDefaultCellBoxOptions_Base);umDefaultCellBoxOptions_Green.fillColor="#00ff00";var umDefaultCellBoxOptions_Red=umClone(umDefaultCellBoxOptions_Base);umDefaultCellBoxOptions_Red.fillColor="#ff0000";var umDefaultCellBoxOptions_Yellow=umClone(umDefaultCellBoxOptions_Base);umDefaultCellBoxOptions_Yellow.fillColor="#ffff00";var umDefaultCellBoxOptions_Blue=umClone(umDefaultCellBoxOptions_Base);umDefaultCellBoxOptions_Blue.fillColor="#0000ff";var umDefaultCellBoxOptions_Purple=umClone(umDefaultCellBoxOptions_Base);umDefaultCellBoxOptions_Purple.fillColor="#ff00ff";var umDefaultCellBoxOptions_Orange=umClone(umDefaultCellBoxOptions_Base);umDefaultCellBoxOptions_Orange.fillColor="#ff6633";function umOnShowCellResource(a){if(typeof a==="undefined"||a===null){return false}var b=a.options[a.selectedIndex].value;umCreateCellResources(b);return false}function umShowCellResourceGuide(b){var a=document.getElementById("umCellResourceGuide");if(a===null){return}if(b){a.style.visibility="visible"}else{a.style.visibility="hidden"}}function umCreateCellBox(f,i,g){var e=umConvertXLocToLng(i*umCellSize);var b=umConvertYLocToLat(g*umCellSize);var d=umConvertXLocToLng(i*umCellSize+umCellSize);var a=umConvertYLocToLat(g*umCellSize+umCellSize);var j=new google.maps.LatLng(b,e);var h=new google.maps.LatLng(a,d);var c=f;c.bounds=new google.maps.LatLngBounds(j,h);NewBox=new google.maps.Rectangle(c);NewBox.setMap(umMap);umCellResourceObjects.push(NewBox)}function umCreateCellResources(a){umClearCellResources();umCurrentCellResource=a;umMapState.CellResource=a;umUpdateLink();if(a===""){umShowCellResourceGuide(false);return}switch(a){case"test1":umCreateCellResourcesTest1();break;case"test2":umCreateCellResourcesTest2();break;case"test3":umCreateCellResourcesTest3();break;default:umGetCellResourceData(a);break}}function umGetCellResourceData(b){if(b===""){umShowCellResourceGuide(false);return}var a=new XMLHttpRequest();var c=umGetResourceURL+"?game="+umGame+"&editorid="+b;a.open("GET",c,true);a.onreadystatechange=function(){if(a.readyState==4){umParseGetCellResourceRequest(a)}};a.send(null)}function umParseGetCellResourceRequest(a){var b=a.responseText;if(b===null){umShowCellResourceGuide(false);return}umCurrentResourceData=JSON.parse(b);umUpdateCellResourceView(umCurrentResourceData)}function umUpdateCellResourceView(a){umClearCellResources();if(typeof a==="undefined"){return}if(a===null){return}if(typeof a.data==="undefined"){return}if(a.data===null){return}umShowCellResourceGuide(true);for(var c=umCellResourceCellX1;c<=umCellResourceCellX2;c++){for(var b=umCellResourceCellY1;b<=umCellResourceCellY2;b++){ResourceCount=a.data[c-umCellResourceCellX1][b-umCellResourceCellY1];if(typeof ResourceCount==="undefined"){continue}if(ResourceCount===null){continue}if(ResourceCount==0){}else{if(ResourceCount<=2){umCreateCellBox(umDefaultCellBoxOptions_Purple,c,b)}else{if(ResourceCount<=5){umCreateCellBox(umDefaultCellBoxOptions_Blue,c,b)}else{if(ResourceCount<=10){umCreateCellBox(umDefaultCellBoxOptions_Green,c,b)}else{if(ResourceCount<=20){umCreateCellBox(umDefaultCellBoxOptions_Yellow,c,b)}else{if(ResourceCount<=50){umCreateCellBox(umDefaultCellBoxOptions_Orange,c,b)}else{umCreateCellBox(umDefaultCellBoxOptions_Red,c,b)}}}}}}}}}function umSetCellResourceList(b){var a=document.getElementById("umCellResourceList");if(a===null){return}a.value=b;console.debug("Setting resource "+b)}function umClearCellResources(){for(var a=0;a<umCellResourceObjects.length;++a){umCellResourceObjects[a].setMap(null)}umCellResourceObjects=[]}function umCreateCellResourcesTest1(){umCreateCellBox(umDefaultCellBoxOptions_Blue,0,0);umCreateCellBox(umDefaultCellBoxOptions_Blue,1,0);umCreateCellBox(umDefaultCellBoxOptions_Red,2,2);umCreateCellBox(umDefaultCellBoxOptions_Red,1,2);umCreateCellBox(umDefaultCellBoxOptions_Red,2,3);umCreateCellBox(umDefaultCellBoxOptions_Red,3,2);umCreateCellBox(umDefaultCellBoxOptions_Green,1,1);umCreateCellBox(umDefaultCellBoxOptions_Green,2,1);umCreateCellBox(umDefaultCellBoxOptions_Yellow,-1,0);umCreateCellBox(umDefaultCellBoxOptions_Yellow,-1,1);umCreateCellBox(umDefaultCellBoxOptions_Yellow,3,1);umShowCellResourceGuide(true)}function umCreateCellResourcesTest2(){umCreateCellBox(umDefaultCellBoxOptions_Blue,10,20);umCreateCellBox(umDefaultCellBoxOptions_Blue,11,20);umCreateCellBox(umDefaultCellBoxOptions_Red,12,22);umCreateCellBox(umDefaultCellBoxOptions_Red,11,22);umCreateCellBox(umDefaultCellBoxOptions_Red,12,23);umCreateCellBox(umDefaultCellBoxOptions_Red,13,22);umCreateCellBox(umDefaultCellBoxOptions_Green,11,21);umCreateCellBox(umDefaultCellBoxOptions_Green,12,21);umCreateCellBox(umDefaultCellBoxOptions_Yellow,14,20);umCreateCellBox(umDefaultCellBoxOptions_Yellow,14,21);umCreateCellBox(umDefaultCellBoxOptions_Yellow,14,21);umShowCellResourceGuide(true)}var umSimpleRandSeed=123456789;function umSimpleRand(){umSimpleRandSeed=(1103515245*umSimpleRandSeed+12345)%4294967296;return umSimpleRandSeed}function umCreateCellResourcesTest3(){umSimpleRandSeed=42;for(var c=0;c<1000;++c){var d=Math.floor((umSimpleRand()/1000)%6);var b=Math.floor((umSimpleRand()/100)%75-37);var a=Math.floor((umSimpleRand()/100)%60-30);switch(d){case 0:umCreateCellBox(umDefaultCellBoxOptions_Blue,b,a);break;case 1:umCreateCellBox(umDefaultCellBoxOptions_Green,b,a);break;case 2:umCreateCellBox(umDefaultCellBoxOptions_Red,b,a);break;case 3:umCreateCellBox(umDefaultCellBoxOptions_Yellow,b,a);break;case 4:umCreateCellBox(umDefaultCellBoxOptions_Purple,b,a);break;case 5:umCreateCellBox(umDefaultCellBoxOptions_Orange,b,a);break;default:umCreateCellBox(umDefaultCellBoxOptions_Red,b,a);break}}umShowCellResourceGuide(true)}var umNewLocClickListener=null;function umSetupEditMap(){if(!umMapState.ShowEdit){return}umAddEditNewLocationLink()}function umOnEditNewLocation(a){if(umNewLocClickListener!==null){google.maps.event.removeListener(umNewLocClickListener);umNewLocClickListener=null;a.innerHTML="New Location";a.style.backgroundColor="";a.style.textColor="";umMap.setOptions({draggableCursor:""});return}a.innerHTML="Click Map To Add...";a.style.backgroundColor="#cc0000";a.style.textColor="#cccccc";umMap.setOptions({draggableCursor:"crosshair"});umNewLocClickListener=google.maps.event.addListenerOnce(umMap,"click",umOnClickAddLocation)}function umOnClickAddLocation(e){var b=document.getElementById("umEditAddLocButton");if(b!==null){b.innerHTML="New Location";b.style.backgroundColor="";b.style.textColor="";umMap.setOptions({draggableCursor:""})}var a=new CMapLocation();a.ID=-1;var f=umConvertLngToLocX(e.latLng.lng());var c=umConvertLatToLocY(e.latLng.lat());a.X=f;a.Y=c;a.MapPoint=new google.maps.LatLng(e.latLng.lat(),e.latLng.lng());a.Show=true;umLocations.push(a);var g=umCreateMapLabel(a);var d=umMakeEditLocationInfoContent(a,g.locationinfoid);g.infowindow.setOptions({disableAutoPan:true});g.infowindow.setContent(d);g.infowindow.open(umMap,g.marker);umAddSearchResult(a)}function umAddEditNewLocationLink(){if(!umMapState.ShowEdit){return}var a=document.getElementById("umMenuLinksRight");if(a===null){return}if(a.children.length<=0){return}var b=a.children[0];var c=b.nodeName.toLowerCase();if(c!=="ol"){return}var d=document.createElement("li");d.id="umEditAddLocButton";d.className="umMenuItem";d.style.right="25px";d.onclick=function(){umOnEditNewLocation(d)};d.appendChild(document.createTextNode("New Location"));b.insertBefore(d,b.getElementsByTagName("li")[0])}function umMakeSaveLocQuery(a,q){var r=q.umEditLocInfoName;var u=q.umEditLocInfoType;var o=q.umEditLocInfoWikiPage;var h=q.umEditLocInfoTags;var t=q.umEditLocInfoDisplayLevel;var l=q.umEditLocInfoLabelPosition;var x=q.umEditLocInfoEditorID;var j=q.umEditLocInfoWorldspace;var s=q.umEditLocInfoNamespace;var v=q.umEditLocInfoRegion;var n=q.umEditLocInfoShow;var g=q.umEditLocInfoX;var f=q.umEditLocInfoY;var e=q.umEditLocInfoZ;var m="?";if(a){m+="id="+a.ID}else{m+="?id=-1"}if(r){if(a){a.Name=r.value}m+="&name="+escape(r.value)+""}if(o){if(a){a.WikiPage=o.value}m+="&page="+escape(o.value)+""}if(g){var d=parseFloat(g.value);if(a){a.X=d}m+="&x="+d+""}if(f){var c=parseFloat(f.value);if(a){a.Y=c}m+="&y="+c+""}if(e){var b=parseFloat(e.value);if(a){a.Z=b}m+="&z="+b+""}if(a){a.MapPoint=umConvertLocToLatLng(a.X,a.Y)}if(u){var k=parseInt(u.value,10);if(a){a.Type=k}m+="&type="+k+""}if(t){var i=parseInt(t.value,10);if(a){a.DisplayLevel=i}m+="&display="+i+""}if(l){var p=parseInt(l.value,10);if(a){a.LabelPosition=p}m+="&labpos="+p+""}if(j){if(a){a.Worldspace=j.value}m+="&ws="+escape(j.value)+""}if(x){if(a){a.EditorID=x.value}m+="&editid="+escape(x.value)+""}if(v){if(a){a.Region=v.value}m+="&region="+escape(v.value)+""}if(s){if(a){a.Namespace=s.value}m+="&ns="+escape(s.value)+""}if(h){if(a){a.Tags=h.value}m+="&tags="+escape(h.value)+""}if(n){var w=0;if(n.checked){w=1}if(a){a.Show=w}m+="&show="+w+""}return m}function umOnOpenEditLocationInfo(c,a){var b=umFindLocationByInfoID(a);if(b===null){return}var d=umMakeEditLocationInfoContent(b,a);b.Label.infowindow.setContent(d)}function umOnCloseEditLocationInfo(c,a){var b=umFindLocationByInfoID(a);if(b===null){return}if(b.ID<0){umDeleteLocation(b)}else{var d=umMakeLocationInfoContent(b,a);b.Label.infowindow.setContent(d);b.Label.infowindow.close()}}function umParseSetMapRequest(b,a,h){var j=b.responseXML;var c=j.documentElement.getElementsByTagName("result");var g=umFindLocationByInfoID(h);if(c.length){var d=unescape(c[0].getAttribute("msg"))+" -- "+unescape(c[0].getAttribute("id"));var i=parseInt(c[0].getAttribute("value"),10);if(i===0){umOutputEditLocationError(h,d);return}else{umOutputEditLocationNotice(h,d)}if(g!==null&&g.ID<0){var e=parseInt(c[0].getAttribute("id"),10);if(e>0){g.ID=e}}}else{umOutputEditLocationError(h,"Unknown error updating location!");return}if(g!==null){var f=umUpdateMapLabel(g);umUpdateSearchResult(g)}}function umSaveLocation(c,f,b){if(f===null||b===null){return false}umOutputEditLocationNotice(b,"Saving...");var a=umMakeSaveLocQuery(c,f);var d=umSetMapURL+a;var e=new XMLHttpRequest();e.open("GET",d,true);e.onreadystatechange=function(){if(e.readyState==4){umParseSetMapRequest(e,f,b)}};e.send(null);return true}function umOnSubmitEditLocation(c,a){var b=umFindLocationByInfoID(a);var d=document.getElementById(a+"form");if(d===null){umOutputEditLocationError(a,'Error saving location!<br />Could not find form with element ID "'+a+'"!');return false}if(b===null){umOutputEditLocationError(a,'Error saving location!<br />Could not find location with element ID "'+a+'"!');return false}umSaveLocation(b,d,a);return false}function umOutputEditLocationMsg(a,c,b){if(a===null){return}var d=document.getElementById("LocEditResult"+a);if(d===null){return}d.innerHTML=c;d.style.backgroundColor=b}function umOutputEditLocationError(a,b){umOutputEditLocationMsg(a,b,"#ff6666")}function umOutputEditLocationWarning(a,b){umOutputEditLocationMsg(a,b,"#ffff66")}function umOutputEditLocationNotice(a,b){umOutputEditLocationMsg(a,b,"#ffffff")}function umMakeLocationLabelPosCombo(c,d){var a="";a+='<select name="'+c+'">';for(var b=1;b<=9;b++){var e=umGetLabelPositionLabel(b);a+='<option value="'+b+'" '+(d==b?"selected":"")+">"+e+" ("+b+")</option>"}a+="</select>";return a}function umMakeLocationTypeCombo(e,f,c){var b="";var h=64;var g=-1;switch(umGame){case"sr":h=64;break;case"db":h=64;break;case"si":h=48;break;case"mw":h=35;break;case"ob":h=48;break}b+='<select name="'+e+'" ';if(c!==null){b+=' onChange="'+c+'" onKeyUp="'+c+'" '}b+=">";for(var d=0;d<=h;d++){var a=umGetMapMarkerType(d);if(a==="Other"){continue}b+='<option value="'+d+'" '+(f==d?"selected":"")+">"+a+" ("+d+")</option>";if(f==d){g=d}}b+='<option value="'+100+'" '+(f==100?"selected":"")+">Other (100)</option>";if(f==100){g=100}if(g<0){b+='<option value="'+f+'" selected>'+Unknown+" ("+f+")</option>"}b+="</select>";return b}function umOnLocEditTypeChange(b,a){var e=document.getElementById(a);if(b===null||e===null){return}var d=b.options[b.selectedIndex].value;var c=umGetMapMarkerIcon(parseInt(d,10));e.style.backgroundImage="url("+c+")"}function umMakeEditLocationInfoContent(d,a){var e;a=typeof a!=="undefined"?a:umCreateUniqueLocationID();if(a===null){a=umCreateUniqueLocationID()}e='<div class="umLocationInfoEdit" id="'+a+'">';e+='<form id="'+a+'form" onSubmit="return false;">';e+='<div class="umLocationInfoTitle">Editing Location #'+d.ID+"</div>";e+='<div class="umLocationEditTitle">Name</div> ';e+='<div class="umLocationEditInput"><input type="text" autocomplete="off" name="umEditLocInfoName" value="'+umHtmlEncode(d.Name)+'" maxlength="100"/></div>';e+='<div class="umLocationEditTitle">Position</div> ';e+='<div class="umLocationEditInputSmall"><input type="text" autocomplete="off" name="umEditLocInfoX" value="'+d.X+'" maxlength="10" /></div> ';e+='<div class="umLocationEditInputSmall"><input type="text" autocomplete="off" name="umEditLocInfoY" value="'+d.Y+'" maxlength="10" /></div> ';e+='<div class="umLocationEditInputSmall"><input type="text" autocomplete="off" name="umEditLocInfoZ" value="'+d.Z+'" maxlength="10" /></div> ';e+='<div class="umLocationEditTitle">Enabled</div> ';e+='<div class="umLocationEditInput"><input type="checkbox"  autocomplete="off" name="umEditLocInfoShow" value="1" '+(d.Show?'checked="checked"':"")+" /></div>";var b=a+"TypeIcon";var c="umOnLocEditTypeChange(this, &quot;"+b+"&quot;);";var f=umGetMapMarkerIcon(d.Type);var g="background-image: url(&quot;"+f+"&quot;);";e+='<div class="umLocationEditTitle">Type</div> ';e+='<div class="umLocationEditInput">';e+=umMakeLocationTypeCombo("umEditLocInfoType",d.Type,c);e+='<div class="umLocationEditTypeIcon" id="'+b+'" style="'+g+'"></div>';e+="</div> ";e+='<div class="umLocationEditTitle">Wiki Page</div> ';e+='<div class="umLocationEditInput"><input type="text" autocomplete="off" name="umEditLocInfoWikiPage" value="'+umHtmlEncode(d.WikiPage)+'" maxlength="100" /></div>';e+='<div class="umLocationEditTitle">Tags</div> ';e+='<div class="umLocationEditInput"><input type="text" autocomplete="off" name="umEditLocInfoTags" value="'+umHtmlEncode(d.Tags)+'" maxlength="100" /></div>';e+='<div class="umLocationEditTitle">Display Level</div> ';e+='<div class="umLocationEditInput"><input type="text" autocomplete="off" name="umEditLocInfoDisplayLevel" value="'+d.DisplayLevel+'" maxlength="100" /></div>';e+='<div class="umLocationEditTitle">Label Pos</div> ';e+='<div class="umLocationEditInput">';e+=umMakeLocationLabelPosCombo("umEditLocInfoLabelPosition",d.LabelPosition);e+="</div> ";e+='<div class="umLocationEditTitle">Editor ID</div> ';e+='<div class="umLocationEditInput"><input type="text" autocomplete="off" name="umEditLocInfoEditorID" value="'+umHtmlEncode(d.EditorID)+'" maxlength="100" /></div>';e+='<div class="umLocationEditTitle">Worldspace</div> ';e+='<div class="umLocationEditInput"><input type="text" autocomplete="off" name="umEditLocInfoWorldspace" value="'+umHtmlEncode(d.Worldspace)+'" maxlength="100" /></div>';e+='<div class="umLocationEditTitle">Namespace</div> ';e+='<div class="umLocationEditInput"><input type="text" autocomplete="off" name="umEditLocInfoNamespace" value="'+umHtmlEncode(d.Namespace)+'" maxlength="100" /></div>';e+='<div class="umLocationEditTitle">Region</div> ';e+='<div class="umLocationEditInput"><input type="text" autocomplete="off" name="umEditLocInfoRegion" value="'+umHtmlEncode(d.Region)+'" maxlength="100" /></div>';e+='<div class="umLocationEditButtons">';e+='<input type="button" value="Save" onClick="umOnSubmitEditLocation(this, &quot;'+a+'&quot;);" />';e+='<input type="button" value="Cancel" onClick="umOnCloseEditLocationInfo(this, &quot;'+a+'&quot;);" />';e+="</div>";e+='<div class="umLocationEditResult" id="LocEditResult'+a+'"></div>';e+="</form></div>";return e};